[tox]
envlist = py27, docs, pre-commit
basepython = python2.7
indexserver =
	default = https://pypi.yelpcorp.com/simple/

[testenv]
basepython = python2.7
deps = -rrequirements.txt

[testenv:py27]
deps = -rrequirements-dev.txt
commands =
    python -m pytest tests/ --capture=no -v --ignore=tests/integration
    python -m pytest tests/integration --capture=no -v
    coverage report --omit=.tox/*,tests/*,replication_handler/models/*,replication_handler/components/stubs/* -m
    flake8 --ignore=E302

[testenv:docs]
deps = {[testenv]deps}
	sphinx
changedir = docs
commands = sphinx-build -b html -d build/doctrees source build/html

[flake8]
ignore = E125, E302
max-line-length = 160
max-complexity = 10
exclude = .svn,CVS,.bzr,.hg,.git,__pycache__,.tox,./build,docs,virtualenv_run

[testenv:pre-commit]
basepython = python2.7
deps = pre-commit>=0.4.2
commands = pre-commit {posargs}

[pytest]
norecursedirs = .* _darcs CVS docs virtualenv_run venv scratch tmp .tox build
addopts = --ignore=setup.py --doctest-glob=*.rst -vv
